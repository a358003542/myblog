Title: django后台api编写之-日志
Date: 2018-05-26

[TOC]
# django日志

## 简介
django使用python的logging模块来作为的自己的日志系统，所以django项目日志管理的深入学习离不开对于logging模块的深入学习。


## logging模块中级教程
logging模块的中级使用需要了解如下几个词汇：loggers, handlers, filters, and formatters。

### loggers 
记录器 之前我们运行logging.info，就是调用的默认的记录器，然后一般我们会针对每个python的模块文件创建一个记录器。


    logger = logging.getLogger(__name__)


这个 `__name__` 只是一种简便的命名方法，如果你勤快或者某种情况下有需要的话完全可以自己手工给记录器取个名字。

然后这个 `getLogger` 函数如果你后面指定的名字之前已经定义了（这通常是指在其他第三方模块下定义了），那么你通过这个 `getLogger` 然后指定目标名字就会得到对应的该记录器。这通常对于DIY某个第三方模块的日志记录器有用。

记录器可以挂载或者卸载某个处理器对象或过滤器对象：
- logger.addHandler()
- logger.removeHandler()
- logger.addFilter()
- logger.removeFilter()

记录器通过 `setLevel()` 方法来设置最小记录级别，这个和后面的Handler级别是协作关系。


### handlers 
处理器负责分发日志信息到目标地去。这里主要介绍这几个Handler类：

- StreamHandler 将信息以流的形式输出，这通常指输出到终端
- FileHandler 将信息写入到某个文件中去
- RotatingFileHandler 将信息写入某个文件，如果文件大小超过某个值，则另外新建一个文件继续写。
- TimeRotatingFileHandler 将信息写入某个文件，每隔一段时间，比如说一天，就会自动再新建一个文件再往里面写。

处理器对象也有 `setLevel` 方法，这个前面也提及了，和记录器的 `setLevel` 是协作关系，更详细的描述是，信息先记录器处理并分发给对应的处理器对象，然后再处理器处理再分发到目的地。

处理器可以挂载 格式器 对象和 过滤器 对象。

- handler.setFormatter()
- handler.addFilter()
- handler.removeFilter()



### filters 
过滤器

### formatters 
格式器，具体信息的格式定义。


## 字典统一配置
django的setting.py就会有这样的配置，具体含义还是很明显的，就是定义处理器，格式器，记录器等。

    LOGGING = {
        'version': 1,
        'disable_existing_loggers': False,
        'formatters': {
            'simple': {
                'format': "%(asctime)s %(name)s [%(levelname)s] %(thread)d %(module)s %(funcName)s %(lineno)s: %(message)s"
            }
        },
        'handlers': {
            'log_file': {
                'class': 'sdsom.common.log.DedupeRotatingAndTimedRotatingFileHandler',
                'filename': config.get('web', 'log_path'),
                'when': 'midnight',
                'maxBytes':int(config.get('web','log_max_bytes')),
                'interval': 1,
                'backupDay': int(config.get('web', 'log_backup_days')),
                'dedupetime': int(config.get('web', 'log_dedupe_time')),
                'formatter': 'simple'
            },
        },
        'loggers': {
            'django.request': {
                'handlers': ['log_file'],
                'level': config.get('web', 'log_level'),
                'propagate': True,
            },
        }
    }

