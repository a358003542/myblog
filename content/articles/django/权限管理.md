Title: django后台api编写之-权限管理
Date: 2018-05-26

[TOC]

## 权限管理

### 认证

在视图类里定义 `authentication_classes` 来确定目标视图类的认证行为，如果没有则采取默认的认证管理类行为。

### 自定义身份认证

写自己的身份认证类，继承自 `BaseAuthentication` ，然后重写 `authenticate(self, request)` 方法，认证成功则返回 `(user, auth)` ，否则返回None。request.user 是当前登录的用户实例， request.auth 是当前登录auth的信息。

某些情况下身份认证失败你可能想要抛出 `AuthenticationFailed` 异常。

### 权限

在视图类里定义 `permission_classes` 来确定目标视图类的权限管理行为，如果没有则采用默认的权限管理类行为。

认证完了就会进去权限管理，也就是权限检查的时候 `request.user`  `request.auth` 已经是可以调用的了。

最简单的权限管理类就是 `IsAuthenticated` ，允许通过身份验证的用户访问，拒绝没通过的用户访问。

`IsAuthenticatedOrReadOnly` 类的意思是通过身份认证的用户完全访问，没有通过身份验证的用户只能进行只读访问。

### 自定义权限管理类

自定义权限管理类，继承自 `BasePermission` ，然后实现下面一个两个方法：

- has_permission(self, request, view)
- has_object_permission(self, request, view, obj)

如果请求被授予权限，则返回True，如果没有权限则返回False。

自定义权限管理类还可以加上 `message` 属性，用户权限没通过抛出 `PermissionDenied` 异常的额外显示信息。