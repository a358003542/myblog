Title: django后台api编写之-模板
Slug: django-templates
Date: 2018-07-10
Modified: 2018-07-25

[TOC]

## 模板基本概念

模板基本的样子如下，下面有模板继承，block ，循环，过滤，之类的。熟悉jinja2模板的同学稍微看下大致是个什么意思就已经清楚了。

```django
{% extends "base_generic.html" %}
{% block title %}{{ section.title }}{% endblock %}
{% block content %}
<h1>{{ section.title }}</h1>
{% for story in story_list %}
<h2>
  <a href="{{ story.get_absolute_url }}">
    {{ story.headline|upper }}
  </a>
</h2>
<p>{{ story.tease|truncatewords:"100" }}</p>
{% endfor %}
{% endblock %}

```

## django如何查找模板的

在django的settings.py哪里有：

```
PROJECT_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

TEMPLATES=[
{
'BACKEND':'django.template.backends.django.DjangoTemplates',
'DIRS':[
os.path.join(PROJECT_DIR,'templates'),
],
```

默认是在每个app下的templates文件里都会递归遍历查找的，这里DIRS加上了另外一个文件夹，也就是现在settings.py所在的那个文件夹下如果有templates文件夹也会去遍历的。



模板文件最后都会合并的，所以就存在模板的覆盖机制了，为了避免无谓的覆盖，一般模板原则上推荐的结构是在templates下面，不管是那个app下面，都再新建一个目标app的名字，再新建模板文件。当然对于稍小的项目直接扔在templates下面问题不大。



比如你想覆盖django自带的admin界面，就要在templates下面新建一个admin文件夹，具体什么模板文件，你要研究下django的源码了。







## django的变量怎么传给javascript

**NOTICE: 现在不推荐这种写法了，推荐走ajax通道传数据。**



django的视图函数在render的时候通过context字典值，里面的各个字段的值将传给django的模板里的变量，这个我们是知道的了，那么django的变量怎么进而传递给javascript呢。本小节参考了 [这个网页](https://stackoverflow.com/questions/7165656/passing-objects-from-django-to-javascript-dom) 。

首先要传递的字段建议如下json封装下：

```
from django.core.serializers.json import DjangoJSONEncoder
{
	what : json.dumps(data['content_images'], cls=DjangoJSONEncoder)
}
```

然后在javascript那边：

```
var what = JSON.parse("{{ what | safe | escapejs }}")
```

注意 `safe` 和 `escapejs` 过滤器。