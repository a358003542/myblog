Title: django后台api编写之-API设计原则
Date: 2018-05-26

[TOC]
## API设计

首先讲一下这里讨论的API设计和网络上流行的Restful风格的API设计都只是一般性原则，并不是强制性的要求。然后API还分为内部使用和对外的API，如果对外的API那么接口最好遵循无惊讶原则，遵循大家都通用的一些写法风格，但如果是内部使用的API，那么很多情况下，还要考虑自己内部使用的便捷性要求。

### url设计
目前url域名都推荐使用 api.what.com 这样的风格，然后关于API的版本，在URL上加上版本号，并不是一个很好的主意。在当前前后端分离的大背景下，这给前端和后端的代码都带来了一些额外的复杂度。

版本号按照 [阮一峰的这篇文章](http://www.ruanyifeng.com/blog/2011/09/restful.html) ，推荐使用 Accept 字段：

```
Accept: vnd.example-com.foo+json; version=2.0
```

url的第一个字段我喜欢使用django的app的名字，然后接下来的第二个字段推荐按照 Restful 风格写上目标资源的名字，并不一定要强制写上名词的复数形式，不过如果有两个url，一个是操纵目标资源集，一个是定向操纵某个目标资源，那么尾缀写上s区分是推荐的风格。

然后针对某个资源或者目标资源集的一些额外的动作，这里所谓的额外的动作是指除了常规的Restful风格的那些增删查改动作之外的额外的动作需求，在上面讨论的Restful风格url基础上加上第三个字段，第三个字段是额外动作的名字是个不错的风格。

### 方法设计
方法通用的 GET POST ，GET用于查询获取资源信息，POST用于创建或修改信息这是没有疑问的。

虽然Restful风格还推荐的DELETE，PATCH等方法，但似乎大家实际编写都只是使用GET和POST方法。


### 参数设计
查询操作如果针对的是目标资源集合，有以下参数是推荐加上的：

- limit 返回个数
- offset 偏移值，可以通过它来实现分页效果
- sort 或者sortby等，总之一个排序的参数
- reverse 排序是否反转的参数

### 状态码设计
具体请参看HTTP的各个状态码。


### 返回内容结构设计
我喜欢使用这种风格：
1. 成功则直接返回各个结果：
```
{
    'a':1
}
```
有些人会说成功之后也应该加上code:200的代码，可是这是完全没有必要的，如果你需要获取数据，那么拿就是了，如果你怕数据不存在，那么加个针对目标数据的判断即可。加个code:200，但是目标数据字段还是不存在，程序不一样也会报错？


2. 失败则必须带上code错误码和msg错误信息
```
{
    'code': 10001,
    'msg': 'your error msg'
}
```
错误码软件系统内部应该有一个统一的规范，常见的错误类型有：

- 资源没有找到
- 找到多个资源
- 未知错误
- 输入缺少参数

### 编写良好的文档
这是当然。


### 参考
1. http://cizixs.com/2016/12/12/restful-api-design-guide

2. 