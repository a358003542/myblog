Title: django后台api编写之-请求和响应
Date: 2018-05-26

[TOC]
## 请求和响应

### request

是的，我们的APIView的一些特殊含义的方法，都会接收一个 request对象，这个对象有：

- query_params 获得GET传过来的参数
- data 获得POST PUT PATCH 传过来的参数，这还没完，传过来的文件，表单都支持。
- user 如果请求经过认证了会返回相应的用户记录，你编写auth类的时候会知道的，如果没有认证，那么返回 `AnonymousUser`



### Response

也就是一些特殊含义的方法的返回对象，其第一个参数是data，字典值，会自动封装成为json友好的格式。实际上我们经常看到的就是这个套路：

```
return Response(serializer.data)
```

然后 serializer 有个 `is_valid` 方法，用来序列化类输出前的预热。这两点在后面序列化的讨论中会涉及。其他一些我们看一下吧：

```
Response(data, status=None, template_name=None, headers=None, content_type=None)
```

headers http协议响应头，status http状态码等等。

整个过程套路，很多高级视图的套路都类似于下面这个例子，多看几遍吧。

```python
class SnippetDetail(APIView):
    """
    Retrieve, update or delete a snippet instance.
    """
    def get_object(self, pk):
        try:
            return Snippet.objects.get(pk=pk)
        except Snippet.DoesNotExist:
            raise Http404

    def get(self, request, pk, format=None):
        snippet = self.get_object(pk)
        serializer = SnippetSerializer(snippet)
        return Response(serializer.data)

    def put(self, request, pk, format=None):
        snippet = self.get_object(pk)
        serializer = SnippetSerializer(snippet, data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

    def delete(self, request, pk, format=None):
        snippet = self.get_object(pk)
        snippet.delete()
        return Response(status=status.HTTP_204_NO_CONTENT)
```

urls.py那边加上的是:

    url(r'^snippets/(?P<pk>[0-9]+)/$', views.SnippetDetail.as_view()),

这里正则表达式 `(?P<pk>[0-9]+)` 的意思是收集某一串数字，这一串数字被命名为 `pk` 。

