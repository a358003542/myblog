Title: 拉链表算法
Date: 2018-07-01
Status: draft

[TOC]



什么是拉链表算法，拉链表算法是为了解决什么问题的，或者说拉链表算法有什么用？



假设数据库里面的一个record，在某个时间点上某几个字段发生了什么变化，然后又过了一定的时间，在某个时间点上某几个字段发生了什么变化。我们该怎样记录研究对象的这种状态变化。

第一，在某些业务需求上，没有必要记录研究对象的历史状态，直接update一条记录，取最新状态即可。这是一个极端；另外一个极端就是每个时间点上，研究对象的所有状态都插入一个record来记录，这是另外一个极端。

如果确实有需求要记录研究对象的所有历史状态，那么第二种做法有太多的冗余信息了，因为我们实际上只需要记录状态发生变化的那个时间点就是了。



拉链表算法的核心设计概念就是在数据库record里面加入了 start_date 和 end_date 这两个字段来表示本记录的生命周期，或者说只有在 start_date < dt < end_date 这个时间段内，该记录才是有效的。



大体设计思路如下，首先设定好几个字段为核心校对字段，查询数据库，发现是否有目标记录，和目录记录的核心校对字段是否一致，如果一致，则什么都不做，也就是pass掉；如果不一致，则新加入一条记录，start_date 设定当前时间，end_date 默认是一个很大的日期时间。然后找到的那条记录只是校对字段不一致的，end_date 要设定为当前时间，如果没有找到任何记录，则新增一条记录，同样start_date 当前日期时间， end_date 默认很大的日期时间。



这样研究对象的状态就由 start_date 和 end_date 这样的区间划分成了一些拉链，而研究对象的最新状态，我们取这样的逻辑，当前时间有效性符合，或者end_date 是最大值的那个，我更喜欢第一个逻辑，当前时间有效性在目标记录的 start_date 和 end_date 这个区间内更合理些。

那么我们如何取研究对象的在某个时间点上的状态，同样取那个时间点，过滤条件同样是满足 start_date 和 end_date 这样区间的那条记录。



有兴趣深究的读者可以查阅其他资料，但实际上弄懂上面讨论的思路了，我相信读者就可以自己去实现自己数据库的拉链表了。



拉链表的好处是不言而喻的，大大节省了数据库空间，真正做到了在保存目标研究对象的时间状态变化问题上的有的放矢。