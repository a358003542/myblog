Title: 推荐系统第一谈
Slug: recommender-talk-one
Date: 2018-11-27
Modified: 2018-12-26
Tags: recommender

[TOC]

## 前言

推荐系统本质上是隶属于机器学习系统的，所以在简单了解下推荐系统相关算法之后，具体实现推荐系统的架构，是应该基于机器学习系统架构，然后在这之上引入新的处理流即可。

### 推荐系统的定义

我们首先看到维基上对于推荐系统的定义：

> 推荐系统是一种信息过滤系统，用来预测用户对物品的“评分”或“偏好”。

这句话暗含了很多信息，很值得我们去玩味。第一推荐系统是一个信息过滤系统，我们可以假设用户进行了某种搜索行为，然后出来了很多搜索结果，这个时候推荐系统对这些搜索结果进行了过滤，筛选出最好的那几条呈现给用户，这大概就是推荐系统做的事情。

我们都已经熟悉推荐系统了，上面澄清了推荐系统和搜索系统的区别，一般推荐系统是没有输入搜索词这个动作的，不过不同的推荐主题我们可以假设对应不同的搜索词。然后平时我们看到的热门榜单页面，排行榜页面一般都不是推荐系统干的事，因为这些页面结果的生成是和用户无关的，这就提到了推荐系统的第二个特性：推荐系统是个性化的，千人千面的。

然后我们再来看推荐系统是用来预测用户对物品的“评分”或“偏好”这句话。这句话除了上面谈及的推荐系统是个性化的之外，还几乎把推荐系统最核心的数据结构和要做的事情给描述出来了。

|       | 物品1 | 物品2 | 物品3 | 物品4 |
| :---: | :---: | :---: | :---: | :---: |
| 用户1 |   2   |   ?   |   3   |   ?   |
| 用户2 |   1   |   2   |   5   |   ?   |
| 用户3 |   ?   |   ?   |   ?   |   ?   |

推荐系统就是要维护这样的用户和物品评分矩阵，这是推荐系统内部最核心的数据。

然后推荐系统是负责进行预测工作的，所以一般推荐的物品是用户没有用过的物品（这里主要指推荐系统内部最核心的工作）。

上面这个数据结构也可以表示成为这样一条条记录：

```
user item rating timestamp
```

一般一条条记录还会加上timestamp时间戳，因为记录的时间戳可以调控记录权重，让最近的记录更重要。

上面谈及的评分矩阵有完备的数据当然好，那么就剩下新物品和新用户到来的时候，那么接下来的评分数据如何填充，这是我们在搭建推荐系统的时候需要思考解决的问题；而实践中可能这个评分矩阵有大量的数据缺失，也就是数据稀疏性问题，这也是推荐系统的一个难点问题；此外甚至可能推荐系统在刚开始搭建的时候，完善没有这样的评分数据，这就是推荐系统中的冷启动问题。

那么我们为什么要维护这样一个评分矩阵，这里的评分的含义其实是非常明显的，就算没有用户直接给物品的评分数据，你也应该暗地里计算一个这样的分数，来标明用户对物品的喜好程度，然后根据这些喜好得分，选择TopN，推荐给用户。所以这样的评分数据就算没有用户直接给出，我们也要自己这边定义算法得到的。



### 推荐系统的类型

目前主流的推荐系统就两个类型：基于用户的协同过滤推荐和基于物品相似度的推荐。



### 推荐系统的python模块支持

推荐系统在python生态圈里面似乎有个已经较为成熟的模块了： 

[https://github.com/NicolasHug/Surprise](https://github.com/NicolasHug/Surprise)

简单看了一下，其提供了一个基本的推荐系统内部基本数据规范接口和基本算法接口，可以对接好进行使用。

但我们也要看到推荐系统是一个和业务贴得非常近的，然后我们也要看到，推荐系统的从搭建到调试到优化，到后期业务需求跟进等等都不是一朝一夕的功夫，是一个从算法上来讲算不上很难，更偏工程实践的领域。

如果后面有需求那么就会开始利用python的相关科学计算模块了，numpy，sklearn等等。



##  推荐系统的可解释性

从个人使用推荐系统情况来，推荐系统的输出页面最好解释性强一点，尽量少一些潜在的模糊的推荐，比如说我跟踪你点了哪里点了哪里所以我推荐给你这个内容，这种话谁都说不出口，连推荐理由都说不出来的推荐系统我们最好不要做，这样给用户的感觉不是很好。

所以我的一个建议是不要收集类似用户的点击或者其他意图不明确的记录，下面这些记录是能被用户认可的，而且意图非常的明显可以作为推荐系统推荐理由。

- 你购买过这个物品，这个物品的标签有什么，根据你喜爱的这个标签，我们给你推荐什么。实际上用户在网站上购买多个物品之后，将会有多个物品的多个标签，多个标签有个计数，每个标签都将输出一个推荐页面。
- 推荐系统页面的输出过滤：推荐系统可以暗含比如距离优先权重，文章时间优先权重等，热度优选权重等，而在实际输出的推荐页面，应该再给用户这些排序选项，这实际上也再暗地里告诉用户我们的推荐是考虑了这些因素的。
- 你购买的物品基因和那些用户相同，他们也喜欢这些物品。这里明确告诉用户你购买过这些物品，我们是根据你的购买记录来做出这些判断的。非常不喜欢推荐系统使用这些信息来进行推荐，你的年龄是多少，你的学历是多少等等，这些推荐第一推荐效果实际上我看了非常的不好，很多网站都用他来解决推荐系统冷启动问题，但我觉得完全没有必要，强制推送用户一堆不喜欢的东西，就好像推销一样是推荐系统的大忌；其次你的这些推荐就是明摆着告诉用户我要收集你的这些个人信息，给人的感觉更加不好。

## 推荐系统的可定制性

前面提到了推荐系统输出页面可以增加一些过滤选项，同样页面还可以加入推荐系统的高级定制选项。这里讨论的可定制性包括时间遗忘权重，喜好标签和自定义标签的标记等等。这些高级定制界面一般用户可能用不到，后面有时间精力可以去开发。

推荐系统的效果最终评判方实际上就在每个用户身上，没有任何人，没有任何算法可以做这个工作；其次推荐系统的很多信息收集也可以放在这个定制页面，实际上某些用户对于上传这些信息也会很热心的，而这将很快的提高推荐系统的质量；最后这个可定制页面对于早期人工输入收集和后期推荐系统某些数据维护也很有帮助。

还是那句话，推荐系统更多的不是某种高难度的算法，而是一个不断完善的工程上的事。









## 推荐系统的数据埋点需求

正如前面提及的目前大概需要这些信息：

- 用户对某个物品的消费记录
- 物品的标签

后期网站页面和推荐系统操作页面需要进行合并融合工作。

按照上面的讨论，推荐系统需要的最核心的数据就是用户对于某个物品的购买记录，不需要其他花里胡哨的瞎猜逻辑。

如果用户没有购买记录，我觉得更好的做法是将某个问题页面，也就是前面提到的推荐系统的可定制性相关页面，在用户查看到推荐栏的时候放出，用户选择之后，立马放出推荐结果。



## 推荐系统的后期

这个是后面的事情了，这里简单提一下，除了上面说到的推荐系统的可定制性外，我觉得推荐系统后期可能面对的最大问题是大数据量下的快速反应问题。

至于人们提及的更高大上的比如更加智能的猜测用户的心意【这里指的是搭建用户的记录知识库】，和用户更优化的对话交互推荐，我觉得这都不算推荐系统的事情，而是智能系统的事情了。



## 推荐系统的实时性和相似扎堆问题

目前我看到的推荐系统在实时性上已经提到了很高的一个程度，基本上做到了用户点击什么立马反应改变推荐结果。总的说来推荐系统实时改变这是很好的，但感觉现在的推荐系统太实时了，也就是那个时间戳权重可能提的太高了，以至于我感觉现在的推荐系统已经没有记忆性了，只是一个实时反映的系统，而没有很好地去维护用户的个性特征特性。这就造成了现在的推荐系统经常出现相似的内容一股脑的扎堆进来，实时性是要的，但过分的提高实时性，实际上就完全放弃了推荐系统的下一步的可改进性。

而推荐系统的下一步可改进性就是除了高大上的猜测用户心意上下功夫，搭建用户模型，更好地为用户画像。

此外还有一个改进路线就是进一步提高推荐系统的推荐结果可解释性和相关可解释路线的多样性。这就好比给用户多增加几个谋士，可能有几个谋士不合乎用户心意，但多增加几个之后，用户的使用体验和满意度肯定会上升的。

具体多种推荐路线那可能就要联系到用户的画像，抓住用户的某个特征然后得出结论，比如说射手座的喜欢购买这些；星期天大家喜欢买这些等。这些谋士的建议可能很不靠谱，但这些推荐建议多几个是不会引起用户的讨厌的，毕竟是用户自己主动去下拉翻动的。



## 推荐系统的早期搭建

基于物品的推荐非常适合早期运行，数据也适合进行线下预处理，即使后期物品数据非常庞大也能做到实时计算和推荐。

所以我们工作推荐系统搭建早期重点精力应该在基于物品的相似度上的推荐。下面是最基础版本的构想：

1. 物品的标签
2. 根据用户的购买记录，找到对应物品的各个标签
3. 根据物品相似度判断得到推荐结果

刚开始的版本就是最粗糙的那个版本，正如前面提及的，推荐系统是个不断优化完善上的工程上的事，随着物品变多，物品标签变多，用户购买记录变多等会出现越来越多要考虑的问题。

先对接线上数据库数据做出一个基本的雏形再说。

## 参考资料

1. 推荐系统 Dietmar Jannach Markus Zanker 著 蒋凡译