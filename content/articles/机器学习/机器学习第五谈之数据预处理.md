Title: 机器学习第五谈之数据预处理
Slug: machine-learning-talk-five
Date: 2018-12-13
Modified: 2018-12-14
Tags: machine-learning

[TOC]

## 前言

sklearn里面有很多数据预处理支持函数，下面主要重点理解这些数据预处理技术。



本文可能涉及的函数在我写的 [bihu模块](https://github.com/a358003542/bihu) 的ml部分的preprocessing里面，大体包含内容如下：

```
- scale 缩放操作 (缩放器 df) 返回df
- inverse_scale 反向缩放操作 (缩放器 df) 返回df
- normalize(df, norm='l1') 归一化
- binarize 二值化 阈值默认为0

- encode 编码
- inverse_encode 反编码 

### 缩放器
- z-score标准化 get_standard_scaler
- minmax缩放 get_minmax_scaler

### 编码器
- get_onehot_encoder

- get_label_encoder
```

## 缩放操作

### 均值移除

我更喜欢称之为z-score缩放，因为学习过统计学的就知道z-score标准分的含义，大体也知道这个缩放操作在做些事情。简单来说就是讲你的张量数据沿着各个特征维度，均值都为0，标准差都为1。



sklearn提供了 `StandardScaler` ，然后你利用它进行fit和tranform操作即可，你还可以继续利用之前的缩放器反向回滚 `inverse_transform`。


### minmax缩放

就是控制你的张量数据的最小值和最大值范围。

sklearn提供了 `MinMaxScaler` 缩放器类，类似上面的你可以进行fit和tranform操作，同样可以利用之前的缩放器进行回滚操作。



## 归一化

sklearn提供了normalize函数来支持你的张量数据的归一化操作，这是一个不可逆的操作。具体就是让特征维度的数据绝对值之和为1，不太清楚这么做有什么用。



## 二值化

就是给定一个阈值，你的张量数据转变成为0 1 值。这个估计在神经网络中有用。





## onehot编码

onehot编码可以算是神经网络里面的基本入门知识了，简单来说就是将 数值或者字符 编码为空间扩展的  0 1 数值特征向量。 具体sklearn提供了 `OneHotEncoder` 来进行相关操作。

比如说 

```
[
	['male', 10],
	['female',5],
	['male', 1]
]
```
其中性别特征列有值 male female 两个值 这一列需要两个bit位 。
而后面的数字列有 1 5 10 三个值   这个特征列需要三个bit位 。
上面的例子一共需要 5 个bit位。


```python
df = pd.DataFrame( [
    ['male', 10],
    ['female',5],
    ['male', 1]
])
encoder = get_onehot_encoder()
encoder.fit(df)
encoder.transform([['female',10]]).toarray()
array([[1., 0., 0., 0., 1.]])
```

上面的例子中 `1 0` 表示 female `0 0 1` 表示 10 。

## label编码

label编码的含义也是很直接简单的，就是给定一个字典值，然后给这些字典里面的单词赋值0,2,3...这样你的张量数据就变成了数值型了。

具体sklearn提供了 `LabelEncoder` 来进行相关操作。



## 计算误差
### 平均绝对误差MAE
数据集所有数据点的绝对误差的平均值
```
import sklearn.metrics as sm
sm.mean_absolute_error(test_data, test_pred)
```
### 均方误差MSE
数据集所有数据点的误差的平方的平均值
```
sm.mean_squared_error(test_data, test_pred)
```
### 均方根误差RMSE
均方误差开个根号，为了更好地描述模型的误差


### 中位数绝对误差
数据集所有数据点的误差的中位数
```
sm.median_absolute_error(test_data, test_pred)
```
### 解释方差分
这个分数用来衡量我们的模型对于数据集波动的解释能力
```
sm.explained_variance_score(test_data, test_pred)
```
### R方得分 R2 score
用来衡量模型对于未知样本的预测效果。
```
sm.r2_score(test_data, test_pred)
```


## 参考资料

1. python机器学习经典案例 Prateek Joshi 著  陶俊杰 陈小莉译
2. [这篇文章不错](https://blog.csdn.net/weixin_40040404/article/details/81291799)