<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="baidu-site-verification" content="D4VqC4HppC" /> 
	<meta name="msvalidate.01" content="55CB117A61A6F8286173763FB18D9625" />
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-5644206261254049",
        enable_page_level_ads: true
      });
    </script>
    
    
    <meta name="author" content="cdwanze"/>
    <meta name="copyright" content="cdwanze"/>

    <meta property="og:type" content="article"/>
    <meta name="twitter:card" content="summary">

<meta name="keywords" content=", python语言, " />

<meta property="og:title" content="python语言学习之-官方模块第四谈 "/>
<meta property="og:url" content="/articles/python-modules-four.html" />
<meta property="og:description" content="ctypes模块 如果你的python程序需要和别人的dll进行交互，那么你就必须了解ctypes模块了。ctypes在linux也可以和c语言的so库进行交互，本文重点讨论的是在windows下和dll交互的问题。 基本的使用如下： lib_comm = ctypes.windll.LoadLibrary(get_dll_path(&#39;your_dll.dll&#39;)) 假设你的your_dll.dll 里面 helloworld 函数，那么就可以这样调用这个函数了。 lib_comm.helloworld() 接下的使用主要就是考虑python的数据类型和dll里面的c语言数据类型的对接问题（可能还会牵涉到字符串编码问题。） 官方文档 的那个数据类型对应表格是必看的。基本类型都还好，主要是指针和结构体这两块要理解清楚。 首先你需要在python脚本中大概类似下面的创建一个对应于C语言的里面定义的结构体： class YOU_STRUCTURE(ctypes.Structure): &#34;&#34;&#34; 基础信息结构体 &#34;&#34;&#34; _fields_ = [ (&#39;a&#39;, ctypes.c_int), (&#39;b&#39;, ctypes.c_char * 24), (&#39;c&#39;, ctypes.c_char * 40), ] 然后实际使用如下： s = YOU_STRUCTURE() _ref_s = ctypes …" />
<meta property="og:site_name" content="cdwanze的博文" />
<meta property="og:article:author" content="cdwanze" />
<meta property="og:article:published_time" content="2018-10-12T00:00:00+08:00" />
<meta property="" content="2018-10-12T00:00:00+08:00" />
<meta name="twitter:title" content="python语言学习之-官方模块第四谈 ">
<meta name="twitter:description" content="ctypes模块 如果你的python程序需要和别人的dll进行交互，那么你就必须了解ctypes模块了。ctypes在linux也可以和c语言的so库进行交互，本文重点讨论的是在windows下和dll交互的问题。 基本的使用如下： lib_comm = ctypes.windll.LoadLibrary(get_dll_path(&#39;your_dll.dll&#39;)) 假设你的your_dll.dll 里面 helloworld 函数，那么就可以这样调用这个函数了。 lib_comm.helloworld() 接下的使用主要就是考虑python的数据类型和dll里面的c语言数据类型的对接问题（可能还会牵涉到字符串编码问题。） 官方文档 的那个数据类型对应表格是必看的。基本类型都还好，主要是指针和结构体这两块要理解清楚。 首先你需要在python脚本中大概类似下面的创建一个对应于C语言的里面定义的结构体： class YOU_STRUCTURE(ctypes.Structure): &#34;&#34;&#34; 基础信息结构体 &#34;&#34;&#34; _fields_ = [ (&#39;a&#39;, ctypes.c_int), (&#39;b&#39;, ctypes.c_char * 24), (&#39;c&#39;, ctypes.c_char * 40), ] 然后实际使用如下： s = YOU_STRUCTURE() _ref_s = ctypes …">

    <title>python语言学习之-官方模块第四谈  · cdwanze的博文
</title>


    <link href="/theme/css/font-awesome.css" rel="stylesheet" media="screen">
    <link href="/theme/css/bootstrap.min.css" rel="stylesheet" media="screen">

    <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/theme/css/elegant.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">






</head>
<body>

<nav class="navbar">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false">
                <span class="sr-only">Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        
            <a class="navbar-brand" href="/"><span class=site-name>网站首页</span></a>
        </div>


        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav nav-pills pull-right">
                <li >
                    <a href="">博文首页</a></li>

                <form action="/search.html" onsubmit="return validateForm(this.elements['q'].value);" class="navbar-form navbar-right">
                <input type="text" name="q"  id="tipue_search_input" class="form-control" placeholder="Search...">
                <input class="btn btn-default" type="submit" value="搜索" >
                </form>
                
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">查找文章<span class="caret"></span></a>
                 <ul class="dropdown-menu">
                  <li><a class="slowscroll" href="/categories.html">按分类</a></li>
                 <li><a class="slowscroll" href="/tags.html">按标签</a></li>
                </ul>
                </li>

                  
                <li >
                    <a href="/guan-yu-ben-wang-zhan.html">关于本网站</a></li>
                <li >
                    <a href="/gong-gao.html">公告</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="container-fluid">
    <div class="col-md-1 col-md-1-left"></div>
    <div class="col-md-10">
<article>
<div class="row">
    <header class="page-header col-md-10 col-md-offset-2">
    <h1><a href="/articles/python-modules-four.html"> python语言学习之-官方模块第四谈  </a></h1>
    </header>
</div>

<div class="row">
        <div class="col-md-8 col-md-offset-2 article-content">

            
            <h2 id="ctypes">ctypes模块</h2>
<p>如果你的python程序需要和别人的dll进行交互，那么你就必须了解ctypes模块了。ctypes在linux也可以和c语言的so库进行交互，本文重点讨论的是在windows下和dll交互的问题。</p>
<p>基本的使用如下：</p>
<div class="highlight"><pre><span></span><span class="n">lib_comm</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">LoadLibrary</span><span class="p">(</span><span class="n">get_dll_path</span><span class="p">(</span><span class="s1">&#39;your_dll.dll&#39;</span><span class="p">))</span>
</pre></div>


<p>假设你的your_dll.dll 里面 helloworld 函数，那么就可以这样调用这个函数了。</p>
<div class="highlight"><pre><span></span><span class="n">lib_comm</span><span class="o">.</span><span class="n">helloworld</span><span class="p">()</span>
</pre></div>


<p>接下的使用主要就是考虑python的数据类型和dll里面的c语言数据类型的对接问题（可能还会牵涉到字符串编码问题。）</p>
<p><a href="https://docs.python.org/3.7/library/ctypes.html">官方文档</a> 的那个数据类型对应表格是必看的。基本类型都还好，主要是指针和结构体这两块要理解清楚。</p>
<p>首先你需要在python脚本中大概类似下面的创建一个对应于C语言的里面定义的结构体：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">YOU_STRUCTURE</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    基础信息结构体</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">),</span>  
        <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char</span> <span class="o">*</span> <span class="mi">24</span><span class="p">),</span> 
        <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char</span> <span class="o">*</span> <span class="mi">40</span><span class="p">),</span> 
    <span class="p">]</span>
</pre></div>


<p>然后实际使用如下：</p>
<div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">YOU_STRUCTURE</span><span class="p">()</span>
<span class="n">_ref_s</span>  <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>


<p>通过 byref 来获取到目标结构体的指针，实际调用dll里面的函数传递对应的结构体数据，就是把对应的指针，即上面的 <code>_ref_s</code> 传递过去。</p>
<div class="highlight"><pre><span></span><span class="n">lib_comm</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">_ref_s</span><span class="p">)</span>
</pre></div>


<h3 id="_1">参考资料</h3>
<ul>
<li><a href="http://www.cnblogs.com/night-ride-depart/p/4907613.html">python ctypes探究</a></li>
</ul>
            
            
            <hr/>

        </div>
        <section>
        <div class="col-md-2" style="float:right;font-size:0.9em;">
            <h4>首发于：</h4>
            <time pubdate="pubdate" datetime="2018-10-12T00:00:00+08:00">2018年 10月 12日 </time>

<h4>最近更新于：</h4>
<time datetime="2018-10-12T00:00:00+08:00">2018年 10月 12日 </time>

            <h4>分类：</h4>
            <a class="category-link" href="/categories.html#pythonyu-yan-ref">python语言</a>
        </div>
        </section>
</div>
</article>
    </div>
    <div class="col-md-1"></div>

</div>


<div id="push"></div>


<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a> and updated by <a href="http://www.cdwanze.work" title="cdwanze Home Page">cdwanze</a></li>
    </ul>
</div>
</footer>

    <script src="/theme/js/jquery.min.js"></script>
<script src="/theme/js/bootstrap.min.js"></script>
<script>
    function validateForm(query) {
        return (query.length > 0);
    }
</script>


    



</body>
</html>